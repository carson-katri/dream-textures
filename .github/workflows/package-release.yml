name: Package Release
on: [push]
  # push:
  #   branches:
  #     - "releases/**"

jobs:
  darwin-arm64-release:
    runs-on: macos-12
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          submodules: recursive
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install dependencies into target
        run: pip install -r requirements-mac-MPS-CPU.txt --no-cache-dir --target ../.python_dependencies
        working-directory: stable_diffusion
      - name: Archive Release
        uses: thedoctor0/zip-release@main
        with:
          type: zip
          filename: release.zip
          exclusions: '*.git*'
      - name: Archive addon
        uses: actions/upload-artifact@v3
        with:
          name: dream_textures-darwin-arm64-release.zip
          path: release.zip